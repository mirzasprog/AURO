<nb-card class="stavke-pregled-modal">
  <nb-card-header>
    {{ naslov }} - stavke
  </nb-card-header>
  <nb-card-body>
    <div class="alert alert-danger" *ngIf="greska">{{ greska }}</div>
    <div class="text-center text-muted py-2" *ngIf="!loading && !stavke.length && !greska">
      Nema stavki za prikaz.
    </div>
    <div class="text-muted mb-2" *ngIf="!loading && stavke.length">
      Ukupno artikala na akciji: {{ ukupnoArtikala }}
    </div>
    <div class="table-responsive stavke-pregled-table" *ngIf="!loading && stavke.length; else loadingStavke">
      <table class="table table-sm table-hover table-striped align-middle">
        <thead>
          <tr>
            <th>Šifra artikla</th>
            <th>Artikal</th>
            <th>Bar kod</th>
            <th>Dobavljač</th>
            <th>Status</th>
            <th class="text-end">Akcijska MPC</th>
            <th class="text-end">AS SA / MO / BL</th>
            <th class="text-end">Zaliha</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let stavka of stavke">
            <td>
              <div class="cell-primary">{{ stavka.sifra || '—' }}</div>
            </td>
            <td>
              <div class="cell-primary">{{ stavka.naziv || 'Nepoznat artikal' }}</div>
              <div class="opis-text" *ngIf="stavka.opis">{{ stavka.opis }}</div>
            </td>
            <td>{{ stavka.barKod || 'N/A' }}</td>
            <td>{{ stavka.dobavljac || '—' }}</td>
            <td>
              <span class="status-pill" [ngClass]="{
                'status-pill--success': stavka.status?.toLowerCase() === 'aktivno',
                'status-pill--danger': stavka.status?.toLowerCase() === 'blokiran',
                'status-pill--warning': stavka.status?.toLowerCase() === 'na čekanju'
              }">
                {{ stavka.status || 'N/A' }}
              </span>
            </td>
            <td class="text-end">{{ stavka.akcijskaMpc | number: '1.2-2' }}</td>
            <td class="text-end">
              <div class="stacked-values">
                <span>SA: {{ stavka.asSa | number: '1.0-2' }}</span>
                <span>MO: {{ stavka.asMo | number: '1.0-2' }}</span>
                <span>BL: {{ stavka.asBl | number: '1.0-2' }}</span>
              </div>
            </td>
            <td class="text-end">{{ stavka.zaliha || 0 }}</td>
          </tr>
        </tbody>
      </table>
    </div>
    <ng-template #loadingStavke>
      <div class="d-flex justify-content-center">
        <nb-spinner></nb-spinner>
      </div>
    </ng-template>
  </nb-card-body>
  <nb-card-footer class="col">
    <button style="float:inline-start;" nbButton status="success" size="small"
     (click)="exportujStavke()" [disabled]="!stavke.length">
    <nb-icon icon="download"></nb-icon> Excel
    </button>
    <button style="float:inline-end;" nbButton status="danger" size="small" (click)="zatvori()">Zatvori</button>
  </nb-card-footer>
</nb-card>
