<!--Rola: Interna / Područni / Regionalni-->
<nb-card *ngIf="rola !== 'prodavnica'" class="dashboard-card">
  <nb-card-header class="dashboard-header">
    <div class="header-content">
      <div class="header-icon">
        <nb-icon icon="flash-outline"></nb-icon>
      </div>
      <div class="header-copy">
        <span class="subtitle">Brzi pristup</span>
        <h2>Radna ploča</h2>
        <p>Centraliziran pregled ključnih operacija i najčešćih radnji.</p>
      </div>
    </div>
  </nb-card-header>
  <nb-card-body>
    <div class="quick-actions-grid">
      <nb-card *ngFor="let action of quickActions" class="quick-action" [ngClass]="action.accent"
               (click)="onQuickAction(action.action)" (keyup.enter)="onQuickAction(action.action)"
               (keyup.space)="onQuickAction(action.action)" tabindex="0" role="button"
               [attr.aria-label]="action.title">
        <nb-card-body>
          <div class="quick-action-icon">
            <nb-icon [icon]="action.icon"></nb-icon>
          </div>
          <div class="quick-action-content">
            <h5>{{ action.title }}</h5>
            <p>{{ action.description }}</p>
          </div>
          <button nbButton status="primary" size="small" hero type="button"
                  (click)="onQuickAction(action.action, $event)">
            <nb-icon icon="external-link-outline"></nb-icon>
            {{ action.cta }}
          </button>
        </nb-card-body>
      </nb-card>
    </div>
  </nb-card-body>
</nb-card>

<!--Rola: Prodavnica-->
<nb-card *ngIf="rola === 'prodavnica'" class="dashboard-card store-dashboard">
  <nb-card-header class="dashboard-header">
    <div class="header-content">
      <div class="header-icon">
        <nb-icon icon="activity-outline"></nb-icon>
      </div>
      <div class="header-copy">
        <span class="subtitle">Pregled performansi</span>
        <h2>Statistika prodavnice</h2>
        <p>Pratite ključne metrike i trendove u realnom vremenu.</p>
      </div>
    </div>
  </nb-card-header>
  <nb-card-body>
    <section class="kpi-section">
      <div class="kpi-loading" *ngIf="isDashboardLoading">
        <nb-spinner size="large"></nb-spinner>
      </div>
      <div class="kpi-grid" *ngIf="!isDashboardLoading && dashboardSummary">
        <div class="kpi-card" *ngFor="let card of getKpiCards()" (click)="openKpiDetail(card.key)">
          <span class="kpi-title">{{ card.label }}</span>
          <div class="kpi-value">{{ card.formattedValue }}<small *ngIf="card.unit"> {{ card.unit }}</small></div>
          <span class="kpi-hint">Kliknite za detalje</span>
        </div>
      </div>
    </section>

    <section class="chart-grid">
      <nb-card *ngFor="let chartItem of storeCharts" class="chart-card">
        <nb-card-header>
          <div class="chart-header">
            <div class="icon-wrapper">
              <nb-icon [icon]="chartItem.icon"></nb-icon>
            </div>
            <div>
              <h5>{{ chartItem.title }}</h5>
              <small>{{ chartItem.description }}</small>
            </div>
          </div>
        </nb-card-header>
        <nb-card-body>
          <div class="chart-wrapper">
            <canvas [attr.id]="chartItem.id"></canvas>
          </div>
        </nb-card-body>
      </nb-card>
    </section>

    <section class="chart-grid comparison-grid">
      <nb-card *ngFor="let chartItem of comparisonCharts" class="chart-card">
        <nb-card-header>
          <div class="chart-header">
            <div class="icon-wrapper">
              <nb-icon [icon]="chartItem.icon"></nb-icon>
            </div>
            <div>
              <h5>{{ chartItem.title }}</h5>
              <small>{{ chartItem.description }}</small>
            </div>
          </div>
        </nb-card-header>
        <nb-card-body>
          <div class="chart-wrapper">
            <canvas [attr.id]="chartItem.id"></canvas>
          </div>
        </nb-card-body>
      </nb-card>
    </section>
  </nb-card-body>
</nb-card>

<ng-template #visitorsDetail>
  <nb-card>
    <nb-card-header>Trend posjetilaca</nb-card-header>
    <nb-card-body>
      <div class="modal-chart">
        <canvas id="visitorsTrendChart"></canvas>
      </div>
    </nb-card-body>
  </nb-card>
</ng-template>

<ng-template #turnoverDetail>
  <nb-card>
    <nb-card-header>Trend prometa</nb-card-header>
    <nb-card-body>
      <div class="modal-chart">
        <canvas id="turnoverTrendChart"></canvas>
      </div>
    </nb-card-body>
  </nb-card>
</ng-template>

<ng-template #shrinkageDetail>
  <nb-card>
    <nb-card-header>Trend otpisa</nb-card-header>
    <nb-card-body>
      <div class="modal-chart">
        <canvas id="shrinkageTrendChart"></canvas>
      </div>
    </nb-card-body>
  </nb-card>
</ng-template>

<ng-template #basketDetail>
  <nb-card>
    <nb-card-header>Prosječna vrijednost korpe</nb-card-header>
    <nb-card-body>
      <div class="modal-chart">
        <canvas id="basketTrendChart"></canvas>
      </div>
    </nb-card-body>
  </nb-card>
</ng-template>

<ng-template #categoryDetail>
  <nb-card>
    <nb-card-header>Udio kategorija u prodaji</nb-card-header>
    <nb-card-body>
      <div class="modal-chart">
        <canvas id="categoryShareChart"></canvas>
      </div>
    </nb-card-body>
  </nb-card>
</ng-template>