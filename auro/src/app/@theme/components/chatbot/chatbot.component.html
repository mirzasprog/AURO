<div class="chatbot-wrapper" [class.open]="isOpen">
  <button class="chatbot-toggle" (click)="toggleChat()" aria-label="Otvori K360 chatbot">
    <span class="avatar-ring">
      <img src="assets/images/Konzum360.png" alt="K360 avatar" />
    </span>
    <span class="toggle-label">K360 chatbot</span>
  </button>

  <nb-card *ngIf="isOpen" class="chatbot-card" aria-live="polite">
    <nb-card-header>
      <div class="header-content">
        <div class="brand">
          <span class="brand-avatar">
            <img src="assets/images/Konzum360.png" alt="K360 avatar" />
          </span>
          <div>
            <div class="title">K360 chatbot</div>
            <div class="subtitle">Tvoj diskretni AI partner za brze odgovore i prijedloge.</div>
          </div>
        </div>
        <nb-badge text="LLM" status="info" position="top right"></nb-badge>
      </div>
    </nb-card-header>
    <nb-card-body>
      <div class="chat-layout">
        <div class="chat-window">
          <div
            *ngFor="let message of conversation"
            class="message"
            [class.from-user]="message.from === 'user'"
            [class.from-bot]="message.from === 'bot'"
          >
            <div class="message-meta">{{ message.timestamp | date:'HH:mm' }}</div>
            <div class="bubble">{{ message.text }}</div>
          </div>
        </div>

        <div class="suggestions" *ngIf="suggestions.length">
          <div class="suggestion-title">Prijedlozi</div>
          <div class="suggestion-list">
            <button nbButton size="tiny" appearance="ghost" *ngFor="let suggestion of suggestions" (click)="useSuggestion(suggestion)">
              {{ suggestion }}
            </button>
          </div>
        </div>
      </div>
    </nb-card-body>
    <nb-card-footer>
      <div class="input-row">
        <input
          nbInput
          fullWidth
          placeholder="Postavi pitanje o AURO aplikaciji"
          [(ngModel)]="currentQuestion"
          (keyup.enter)="submitQuestion()"
          name="chatQuestion"
          autocomplete="off"
        />
        <button nbButton status="primary" (click)="submitQuestion()">Pošalji</button>
      </div>
      <div class="footer-note">Ako odgovor ne postoji, asistent će te uputiti da kontaktiraš IT službu.</div>
    </nb-card-footer>
  </nb-card>
</div>
