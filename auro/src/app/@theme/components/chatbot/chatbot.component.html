<div class="chatbot-wrapper" [class.open]="isOpen">
  <button
    class="chatbot-toggle"
    cdkDrag
    cdkDragBoundary="body"
    (click)="toggleChat()"
    aria-label="Otvori K360 chatbot"
  >
    <span class="avatar-ring">
      <img src="assets/images/KONZUM.png" alt="K360 avatar" />
    </span>
    <span class="toggle-label">K360 chatbot</span>
  </button>

  <nb-card *ngIf="isOpen" class="chatbot-card" aria-live="polite" cdkDrag cdkDragBoundary="body">
    <nb-card-header cdkDragHandle>
      <div class="header-content">
        <div class="brand">
          <span class="brand-avatar">
            <img src="assets/images/KONZUM.png" alt="K360 avatar" />
          </span>
          <div>
            <div class="title">K360 chatbot</div>
            <div class="subtitle">Brze i jasne smjernice za AURO – uvijek pri ruci.</div>
          </div>
        </div>
        <div class="header-actions">
          <nb-badge text="LLM" status="primary" position="top right"></nb-badge>
          <button nbButton ghost size="tiny" status="basic" (click)="toggleChat()" aria-label="Zatvori prozor">
            ✕
          </button>
        </div>
      </div>
    </nb-card-header>
    <nb-card-body>
      <div class="chat-layout">
        <div class="chat-window">
          <div
            *ngFor="let message of conversation"
            class="message"
            [class.from-user]="message.from === 'user'"
            [class.from-bot]="message.from === 'bot'"
          >
            <div class="message-meta">{{ message.timestamp | date:'HH:mm' }}</div>
            <div class="bubble">{{ message.text }}</div>
          </div>
        </div>

        <div class="suggestions" *ngIf="suggestions.length">
          <div class="suggestion-title">Brzi prijedlog</div>
          <div class="suggestion-list">
            <button
              nbButton
              size="small"
              appearance="ghost"
              status="danger"
              *ngFor="let suggestion of suggestions"
              (click)="useSuggestion(suggestion)"
            >
              {{ suggestion }}
            </button>
          </div>
          <div class="suggestion-hint">Svakim otvaranjem se prikazuje novi prijedlog.</div>
        </div>
      </div>
    </nb-card-body>
    <nb-card-footer>
      <div class="input-row">
        <input
          nbInput
          fullWidth
          placeholder="Postavi pitanje o AURO aplikaciji"
          [(ngModel)]="currentQuestion"
          (keyup.enter)="submitQuestion()"
          name="chatQuestion"
          autocomplete="off"
        />
        <button nbButton status="primary" (click)="submitQuestion()">Pošalji</button>
      </div>
      <div class="footer-note">Ako odgovor ne postoji, asistent će te uputiti da kontaktiraš IT službu.</div>
    </nb-card-footer>
  </nb-card>
</div>
